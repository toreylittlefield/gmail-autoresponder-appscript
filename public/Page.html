<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
</head>
<style>
    .btn-group {
        display: flex;
        border-radius: 0.375rem;
        justify-content: space-evenly;
        align-content: center;
        align-items: center;
    }

    .btn {
        border: 1px solid;
        border-bottom-left-radius: 0.5rem;
        border-top-left-radius: 0.5rem;
    }

    .btn.submit {
        background-color: green;
    }

    .btn.cancel {
        background-color: yellow;
    }

    .show {
        visibility: visible;
        opacity: 1;
    }

    .hide {
        visibility: hidden;
        opacity: 0;
    }

    .loader {
        border: 8px solid #f3f3f3;
        border-radius: 50%;
        border-top: 8px solid #3498db;
        width: 15px;
        height: 15px;
        -webkit-animation: spin 2s linear infinite;
        /* Safari */
        animation: spin 2s linear infinite;
    }

    details {
        border: 1px solid #aaa;
        border-radius: 4px;
        padding: .5em .5em 0;
    }

    summary {
        font-weight: bold;
        margin: -.5em -.5em 0;
        padding: .5em;
    }

    details[open] {
        padding: .5em;
    }

    details[open] summary {
        border-bottom: 1px solid #aaa;
        margin-bottom: .5em;
    }

    /* Safari */
    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>
<script>
    /**
    * @typedef {'email-form' | 'name-form' | 'canned-form' | 'label-form'} FormIds
    */

    /**
    * @typedef {  'subject'
  | 'email'
  | 'draftId'
  | 'messageId'
  | 'spreadsheetId'
  | 'nameForEmail'
  | 'labelToSearch'
  | 'labelId'
  | 'filterId'} UserPropsKeys
    */

    let forms = [];

    /** @type FormIds */
    let formIdFromEvent = ''

    function attachFormSubmitListeners() {
        forms = Array.from(document.querySelectorAll('form'));
        forms.forEach((form) => {

            /** @type {FormIds} */
            const id = form.id;

            switch (id) {
                case 'email-form': {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault();
                        formIdFromEvent = id;
                        console.log(formIdFromEvent)
                        handleSubmitEmailForm(this);
                    });
                    break;
                }
                case 'name-form': {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault();
                        // handleSubmitEmailForm(this);
                    });
                    break;
                }
                case 'canned-form': {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault();
                        // handleSubmitEmailForm(this);
                    });
                    break;
                }
                case 'label-form': {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault();
                        // handleSubmitEmailForm(this);
                    });
                    break;
                }
            }
        });
    }

    function onSuccessGetEmails(emailsObject) {
        const { emailAliases, mainEmail, currentEmailUserStore, formName } = emailsObject;

        const emailValues = Object.values([mainEmail, ...emailAliases]);

        const fragment = document.createDocumentFragment();

        emailValues.forEach((email) => {
            const option = document.createElement('OPTION');
            option.value = email;

            const input = document.getElementById('email-input');
            if (input instanceof HTMLInputElement) {
                input.focus();
            }
            fragment.appendChild(option);
        });

        const datalist = document.getElementById('available-emails');
        datalist.appendChild(fragment);

        document.querySelector(`#email-form #current-value`).textContent += `${currentEmailUserStore}`;
    }

    /** 
     * @param {FormIds} formId
     * @param {boolean} disabled
    */
    function toggleLoading(formId, disabled) {
        const loader = document.querySelector(`#${formId} #loader`);
        const submitButton = document.querySelector(`#${formId} button[type = 'submit']`);
        loader.classList.toggle('hide');
        loader.classList.toggle('show');
        submitButton.disabled = disabled;
    }


    function handleSubmitEmailForm(formObject) {
        toggleLoading(formIdFromEvent, true);
        google.script.run.withSuccessHandler(processCallbackSuccess).processFormEventsFromPage(formObject);
    }

    /**
     * @param {Object} formObject
    * @param {string} [formObject.email]
    * @param {string} [formObject.subject]
    * @param {string} [formObject.labelToSearch]
    * @param {string} [formObject.nameForEmail]
    */
    function processCallbackSuccess(formObject) {
        console.log({ formObject })
        if (formObject.email) {
            processEmailForm(formObject)
        }
        if (formObject.subject) {
        }
        if (formObject.labelToSearch) {

        }
        if (formObject.nameForEmail) {

        }
        toggleLoading(formIdFromEvent, false);
    }

    function processEmailForm({ email }) {
        const currentEmailH3 = document.querySelector(`#${formIdFromEvent} #current-value`);
        currentEmailH3.textContent = email;
        alert(`Email Changed!
        Your email is now set to:
            ${email}`);
    }

    function onLoadWrapper() {
        attachFormSubmitListeners();
        setTimeout(() => {
            document.getElementById('p2').classList.toggle('hide');
            document.getElementById('main-wrapper').classList.toggle('hide');
        }, 500)
    }
    window.addEventListener('load', onLoadWrapper);

    google.script.run.withSuccessHandler(onSuccessGetEmails).getUserEmails();
</script>

<body>
    <!-- MDL Progress Bar with Indeterminate Progress -->
    <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
    <div id="main-wrapper" class="mdl-grid hide">
        <!-- EMAIL FORM -->
        <div class="mdl-cell mdl-cell--12-col">
            <div class="mdl-card mdl-shadow--2dp" style="padding: 0px 5px;">

                <form id="email-form">
                    <fieldset>
                        <legend>Current Email Configuration</legend>
                        <div class="mdl-card__title">

                            <h2 class="mdl-card__subtitle-text" id="current-value"></h2>
                            <div id="loader" class="loader hide"></div>
                        </div>
                        <div class="btn-group" role="group">
                            <div style="flex-basis: 70%; width: auto;"
                                class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <label class="mdl-textfield__label" for="email">Choose a email:</label>
                                <input class="mdl-textfield__input" list="available-emails" id="email-input"
                                    name="email" type="email" />
                            </div>
                            <datalist id="available-emails"> </datalist>
                            <button id="email-submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect
                            mdl-button--primary" type="submit">Save</button>
                        </div>
                        <details>
                            <summary>Details</summary>
                            <p>This is the email that will be use to search for incoming emails and filter by in Gmail
                            </p>
                            <p>
                                You can also add aliases to your gmail account see:
                                <a target="_blank" ref="noopener"
                                    href="https://support.google.com/mail/answer/22370?hl=en#zippy=%2Cfilter-using-your-gmail-alias%2Csend-from-a-work-or-school-group-alias">Send
                                    emails from a different address or alias</a>
                            </p>
                        </details>

                    </fieldset>
                </form>
            </div>
        </div>
        <!-- END EMAIL FORM -->

        <!-- NAME FORM -->
        <div class="mdl-cell mdl-cell--12-col">
            <div class="mdl-card mdl-shadow--2dp" style="padding: 0px 5px;">

                <form id="name-form">
                    <fieldset>
                        <legend>Current Email Configuration</legend>
                        <div class="mdl-card__title">

                            <h2 class="mdl-card__subtitle-text" id="current-email"></h2>
                            <div id="loader" class="loader hide"></div>
                        </div>
                        <div class="btn-group" role="group">
                            <div style="flex-basis: 70%; width: auto;"
                                class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <label class="mdl-textfield__label" for="email">Choose a email:</label>
                                <input class="mdl-textfield__input" list="available-emails" id="email-input"
                                    name="email" type="email" />
                            </div>
                            <datalist id="available-emails"> </datalist>
                            <button id="email-submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect
                                    mdl-button--primary" type="submit">Save</button>
                        </div>
                        <details>
                            <summary>Details</summary>
                            <p>This is the email that will be use to search for incoming emails and filter by in Gmail
                            </p>
                            <p>
                                You can also add aliases to your gmail account see:
                                <a target="_blank" ref="noopener"
                                    href="https://support.google.com/mail/answer/22370?hl=en#zippy=%2Cfilter-using-your-gmail-alias%2Csend-from-a-work-or-school-group-alias">Send
                                    emails from a different address or alias</a>
                            </p>
                        </details>

                    </fieldset>
                </form>
            </div>
        </div>
        <!-- END NAME FORM -->


        <!-- SET CANNED / TEMPLATE MSG FORM -->

        <div class="mdl-cell mdl-cell--12-col">
            <div class="mdl-card mdl-shadow--2dp" style="padding: 0px 5px;">

                <form id="canned-form">
                    <fieldset>
                        <legend>Current Email Configuration</legend>
                        <div class="mdl-card__title">

                            <h2 class="mdl-card__subtitle-text" id="current-email"></h2>
                            <div id="loader" class="loader hide"></div>
                        </div>
                        <div class="btn-group" role="group">
                            <div style="flex-basis: 70%; width: auto;"
                                class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <label class="mdl-textfield__label" for="email">Choose a email:</label>
                                <input class="mdl-textfield__input" list="available-emails" id="email-input"
                                    name="email" type="email" />
                            </div>
                            <datalist id="available-emails"> </datalist>
                            <button id="email-submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect
                            mdl-button--primary" type="submit">Save</button>
                        </div>
                        <details>
                            <summary>Details</summary>
                            <p>This is the email that will be use to search for incoming emails and filter by in Gmail
                            </p>
                            <p>
                                You can also add aliases to your gmail account see:
                                <a target="_blank" ref="noopener"
                                    href="https://support.google.com/mail/answer/22370?hl=en#zippy=%2Cfilter-using-your-gmail-alias%2Csend-from-a-work-or-school-group-alias">Send
                                    emails from a different address or alias</a>
                            </p>
                        </details>

                    </fieldset>
                </form>
            </div>
        </div>
        <!-- END SET CANNED / TEMPLATE MSG FORM -->



        <!-- SET LABEL TO SEARCH FORM -->
        <div class="mdl-cell mdl-cell--12-col">
            <div class="mdl-card mdl-shadow--2dp" style="padding: 0px 5px;">

                <form id="label-form">
                    <fieldset>
                        <legend>Current Email Configuration</legend>
                        <div class="mdl-card__title">

                            <h2 class="mdl-card__subtitle-text" id="current-email"></h2>
                            <div id="loader" class="loader hide"></div>
                        </div>
                        <div class="btn-group" role="group">
                            <div style="flex-basis: 70%; width: auto;"
                                class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <label class="mdl-textfield__label" for="email">Choose a email:</label>
                                <input class="mdl-textfield__input" list="available-emails" id="email-input"
                                    name="email" type="email" />
                            </div>
                            <datalist id="available-emails"> </datalist>
                            <button id="email-submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect
                            mdl-button--primary" type="submit">Save</button>
                        </div>
                        <details>
                            <summary>Details</summary>
                            <p>This is the email that will be use to search for incoming emails and filter by in Gmail
                            </p>
                            <p>
                                You can also add aliases to your gmail account see:
                                <a target="_blank" ref="noopener"
                                    href="https://support.google.com/mail/answer/22370?hl=en#zippy=%2Cfilter-using-your-gmail-alias%2Csend-from-a-work-or-school-group-alias">Send
                                    emails from a different address or alias</a>
                            </p>
                        </details>

                    </fieldset>
                </form>
            </div>
        </div>
        <!-- END SET LABEL TO SEARCH FORM -->

    </div>

    </div>

    <div id="output"></div>
</body>

</html>